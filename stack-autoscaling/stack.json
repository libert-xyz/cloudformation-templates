{
   "AWSTemplateFormatVersion": "2010-09-09",
   "Resources": {

       "VPC": {
           "Type": "AWS::CloudFormation::Stack",
           "Properties": {
               "TemplateURL": "https://s3.amazonaws.com/cloudformation-stack-custom/vpc.json",
               "TimeoutInMinutes": "60"
           }
       },

       "ELB": {
           "Type": "AWS::CloudFormation::Stack",
           "Properties": {
               "TemplateURL": "https://s3.amazonaws.com/cloudformation-stack-custom/elb.json",
               "Parameters": {
                  "Pub1" : { "Fn::GetAtt" : [ "VPC", "Outputs.public1" ] },
                  "Pub2" : { "Fn::GetAtt" : [ "VPC", "Outputs.public2" ] },
                  "Pub3" : { "Fn::GetAtt" : [ "VPC", "Outputs.public3" ] },
                  "ElbSG" : { "Fn::GetAtt" : [ "VPC", "Outputs.SGElb" ] }
               },
               "TimeoutInMinutes": "60"
           }
       },

       "LaunchConfig" : {
         "Type": "AWS::CloudFormation::Stack",
         "Properties": {
             "TemplateURL": "https://s3.amazonaws.com/cloudformation-stack-custom/launchConfig.json",
             "Parameters": {
                "SG" : { "Fn::GetAtt" : [ "VPC", "Outputs.InstanceSG" ] }
             },
             "TimeoutInMinutes": "60"

       }
     },

     "AutoScaling" : {
       "Type": "AWS::CloudFormation::Stack",
       "Properties" : {
         "TemplateURL": "https://s3.amazonaws.com/cloudformation-stack-custom/autoscaling.json",
         "Parameters" : {

           "Pub1" : { "Fn::GetAtt" : [ "VPC", "Outputs.public1" ] },
           "Pub2" : { "Fn::GetAtt" : [ "VPC", "Outputs.public2" ] },
           "Pub3" : { "Fn::GetAtt" : [ "VPC", "Outputs.public3" ] },
           "LaunchConf" : {"Fn::GetAtt" : [ "LaunchConfig", "Outputs.LaunchConfiguration" ] },
           "Elb" : { "Fn::GetAtt" : [ "ELB", "Outputs.LoadBalancer" ] }

         },
         "TimeoutInMinutes": "60"
       }
     }
   }
 }
